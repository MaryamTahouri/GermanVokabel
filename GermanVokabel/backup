#####################################################flashcard:
{% extends "vocabulary/base_generic.html" %}

{% block content %}
<h2 class="centered-title">Deine Karteikarten</h2>
<div class="flashcard-container">
    {% if flashcards %}
        <div class="flashcard" id="flashcard">
            <div class="flashcard-inner">
                <!-- Ø¨Ø®Ø´ Ø¬Ù„ÙˆÛŒ ÙÙ„Ø´ Ú©Ø§Ø±Øª -->
                <div class="flashcard-front">
                    <p id="german-word"></p> <!-- Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø¨Ø§ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª -->
                </div>

                <!-- Ø¨Ø®Ø´ Ù¾Ø´Øª ÙÙ„Ø´ Ú©Ø§Ø±Øª -->
                <div class="flashcard-back">
                    <p id="translations"></p> <!-- Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø¨Ø§ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª -->
                </div>
            </div>
        </div>

        <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ -->
        <div class="controls">
            <button id="prev-btn">â® Previous</button>
            <button id="next-btn">Next â¯</button>
            <form id="delete-form" method="post">
                {% csrf_token %}
                <button id="delete-btn" type="submit">Ø­Ø°Ù</button>
            </form>
        </div>
    {% else %}
        <p>Ø´Ù…Ø§ ÙÙ„Ø´ Ú©Ø§Ø±ØªÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    let flashcards = JSON.parse('{{ flashcards|safe|escapejs }}'); // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    console.log('Loaded flashcards:', flashcards); // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„

    let currentIndex = 0;

    function updateFlashcard() {
        if (flashcards.length === 0) {
            // Ø§Ú¯Ø± ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³ØªØŒ Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯
            document.querySelector('.flashcard-container').innerHTML = '<p>Ø´Ù…Ø§ ÙÙ„Ø´ Ú©Ø§Ø±ØªÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';
            return;
        }

        const germanWord = document.getElementById('german-word');
        const translations = document.getElementById('translations');

        germanWord.innerText = flashcards[currentIndex].word.german_word;
        translations.innerHTML = `<strong>English:</strong> ${flashcards[currentIndex].word.english_word || 'Not available'}<br>
                                   <strong>Farsi:</strong> ${flashcards[currentIndex].word.farsi_word || 'Not available'}`;
    }

    function showPrevFlashcard() {
        if (currentIndex > 0) {
            currentIndex--;
            updateFlashcard();
        }
    }

    function showNextFlashcard() {
        if (currentIndex < flashcards.length - 1) {
            currentIndex++;
            updateFlashcard();
        }
    }

    document.getElementById('flashcard').addEventListener('click', function () {
        this.classList.toggle('flipped');
    });

    document.getElementById('prev-btn').addEventListener('click', showPrevFlashcard);
    document.getElementById('next-btn').addEventListener('click', showNextFlashcard);

    // Ø¯Ú©Ù…Ù‡ Ø­Ø°Ù ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª
    const deleteButton = document.getElementById('delete-btn');
    deleteButton.addEventListener('click', function (event) {
        event.preventDefault();

        const flashcardId = flashcards[currentIndex].id;

        fetch(`/remove-flashcard/${flashcardId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                console.log(data.message);

                // Ø­Ø°Ù ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡
                flashcards.splice(currentIndex, 1);

                if (flashcards.length > 0) {
                    // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯
                    currentIndex = currentIndex === flashcards.length ? currentIndex - 1 : currentIndex;
                    updateFlashcard();
                } else {
                    // Ø§Ú¯Ø± ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø®Ø§Ù„ÛŒ Ø´Ø¯Ù†Ø¯ØŒ Ù¾ÛŒØ§Ù… Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯
                    document.querySelector('.flashcard-container').innerHTML = '<p>Ø´Ù…Ø§ ÙÙ„Ø´ Ú©Ø§Ø±ØªÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯.</p>';
                }
            } else {
                console.error('Error removing flashcard:', data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    });

    // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    updateFlashcard();
});

</script>
{% endblock %}


#########################################################viwes.py:
from django.shortcuts import render, redirect, get_object_or_404
import json
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth import login, authenticate, logout
from .models import Word, Flashcard
from .utils import generate_audio_file
import os
from django.conf import settings
from .forms import RegisterForm
from django.contrib.auth.decorators import login_required


def register(request):
    if request.method == 'POST':
        form = RegisterForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)  # ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø§Ø±Ø¨Ø±
            return redirect('home')  # Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
    else:
        form = RegisterForm()
    return render(request, 'vocabulary/register.html', {'form': form})


def custom_logout(request):
    if request.method == 'POST':
        logout(request)
        return render(request, 'vocabulary/logout.html')
    return redirect('home')  # Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØºÛŒÛŒØ± Ù…Ø³ÛŒØ± Ù¾ÛŒØ´ ÙØ±Ø¶


def home(request):
    return render(request, 'vocabulary/search.html')  # Ù†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„ search.html Ø¨Ù‡ Ø¬Ø§ÛŒ home.html

def word_list(request):
    words = Word.objects.all()  # Alle WÃ¶rter aus der Datenbank abrufen

    # Audiodateien fÃ¼r jedes Wort generieren
    for word in words:
        audio_path = os.path.join(settings.MEDIA_ROOT, 'audio', f"{word.german_word}.mp3")
        if not os.path.exists(audio_path):  # Nur generieren, wenn die Datei fehlt
            generate_audio_file(word.german_word)

    return render(request, 'vocabulary/word_list.html', {'words': words})


def search_word(request):
    query = request.GET.get('query')  # Ø¯Ø±ÛŒØ§ÙØª Ú©Ù„Ù…Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ø´Ø¯Ù‡
    words = None
    flashcard_ids = []  # Ù„ÛŒØ³Øª Ø¢ÛŒâ€ŒØ¯ÛŒ Ú©Ù„Ù…Ø§Øª Ø¯Ø± ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª Ú©Ø§Ø±Ø¨Ø±
    message = ""

    if query:  # Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ú†ÛŒØ²ÛŒ Ø¬Ø³ØªØ¬Ùˆ Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
        words = Word.objects.filter(german_word__iexact=query)  # Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ù„Ù…Ù‡ Ø¢Ù„Ù…Ø§Ù†ÛŒ
        if not words.exists():
            message = f"Es wurden keine EintrÃ¤ge fÃ¼r das Wort '{query}' gefunden."
        else:
            # Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ú©Ù‡ Ú©Ø¯Ø§Ù… Ú©Ù„Ù…Ø§Øª Ø¯Ø± ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª Ú©Ø§Ø±Ø¨Ø± Ù‡Ø³ØªÙ†Ø¯
            if request.user.is_authenticated:  # Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯ÛŒÙ† Ø¨ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±
                flashcard_ids = Flashcard.objects.filter(user=request.user, word__in=words).values_list('word_id', flat=True)
    else:
        message = "Bitte geben Sie ein Wort zum Suchen ein..."

    return render(request, 'vocabulary/search.html', {
        'words': words,
        'flashcard_ids': list(flashcard_ids),  # Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒØ³Øª Ø¢ÛŒâ€ŒØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª
        'message': message,
        'query': query
    })


@login_required
def add_to_flashcards(request):
    if request.method == "POST":
        word_id = request.POST.get("word_id")
        if request.user.is_authenticated and word_id:
            word = Word.objects.get(id=word_id)
            # Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ú©Ù‡ Ø¢ÛŒØ§ Ú©Ù„Ù…Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
            flashcard, created = Flashcard.objects.get_or_create(user=request.user, word=word)
            print(f"Flashcard created: {created}, Word: {word.german_word}")

            # Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ù‚Ø¨Ù„ÛŒ
            return redirect(request.META.get('HTTP_REFERER', '/'))
    return redirect('home')  # Ø§Ú¯Ø± Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯ØŒ Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø±Ú¯Ø±Ø¯ÛŒØ¯

@login_required
def flashcards(request):
    user_flashcards = Flashcard.objects.filter(user=request.user)
    flashcards = [
        {
            "id": fc.id,  # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ID ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±Øª
            "word": {
                "german_word": fc.word.german_word,
                "english_word": fc.word.english_word,
                "farsi_word": fc.word.farsi_word,
            }
        }
        for fc in user_flashcards
    ]
    print(f"Flashcards data for user {request.user}: {flashcards}")  # Ù„Ø§Ú¯ Ú¯Ø±ÙØªÙ† Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
    return render(request, 'vocabulary/flashcards.html', {'flashcards': json.dumps(flashcards)})


@login_required
def remove_flashcard(request, flashcard_id):
    flashcard = get_object_or_404(Flashcard, id=flashcard_id, user=request.user)
    flashcard.delete()
    return redirect('flashcards')  # Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øªâ€ŒÙ‡Ø§




#########################################urls.py:


from django.urls import path
from . import views
from django.contrib.auth import views as auth_views
from .views import add_to_flashcards, flashcards

urlpatterns = [
    path('', views.home, name='home'),# Hauptseite
    path('register/', auth_views.LoginView.as_view(template_name='vocabulary/register.html'), name='register'),
    path('accounts/login/', auth_views.LoginView.as_view(template_name='vocabulary/login.html'), name='login'),
    path('accounts/logout/', auth_views.LogoutView.as_view(), name='logout'),
    path('word_list/', views.word_list, name='word_list'),
    path('search/', views.search_word, name='search_word'),  # Hier wird 'search_word' registriert
    path('add-to-flashcards/', add_to_flashcards, name='add_to_flashcards'),
    path('flashcards/', views.flashcards, name='flashcards'),
    path('remove-flashcard/<int:flashcard_id>/', views.remove_flashcard, name='remove_flashcard'),

]


#######################search
{% extends "vocabulary/base_generic.html" %}
{% load static %}

{% block title %}Suchergebnis{% endblock %}

{% block content %}
<main>
    <!-- ÙØ±Ù… Ø¬Ø³ØªØ¬Ùˆ -->
    <form method="get" action="{% url 'search_word' %}" class="search-form">
        <div class="search-container">
            <div class="flag-container">
                <img src="{% static 'germany.png' %}" alt="Germany Flag" class="flag-circle-small">
            </div>
            <input type="text" name="query" placeholder="Geben Sie ein deutsches Wort ein..." value="{{ query }}">
            <button type="submit">ğŸ”</button>
        </div>
    </form>

    <!-- Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ -->
    <div class="results-container">
        {% if query %}
            {% if words %}
                {% for word in words %}
                    <!-- Ø±Ø¯ÛŒÙ Ù†ØªÛŒØ¬Ù‡ -->
                    <div class="result-row">
                        <!-- Ø³ØªÙˆÙ† Ø¢Ù„Ù…Ø§Ù†ÛŒ -->
                        <div class="result-column left-column">
                            <div class="german-flag-text">
                                <img src="{% static 'germany.png' %}" alt="Germany Flag" class="flag-circle-small">
                                {% if word and word.gender %}
                                    <span class="gender {% if word.gender == 'm' %}masculine{% elif word.gender == 'f' %}feminine{% elif word.gender == 'n' %}neutral{% endif %}">
                                        {% if word.gender == 'm' %} der
                                        {% elif word.gender == 'f' %} die
                                        {% elif word.gender == 'n' %} das
                                        {% endif %}
                                    </span>
                                {% endif %}
                                <h2 class="word-type {{ word.word_type }}">
                                    {{ word.german_word }}
                                    {% if word.get_word_type_display %}
                                        <small class="word-type">({{ word.get_word_type_display }})</small>
                                    {% endif %}
                                </h2>
                                {% if word.audio %}
                                    <button class="play-audio-btn" onclick="playAudio('{{ word.audio.url }}')">ğŸ”Š</button>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Ø³ØªÙˆÙ† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ -->
                        <div class="result-column center-column">
                            <div class="english-flag-text">
                                <img src="{% static 'united_kingdom.png' %}" alt="UK Flag" class="flag-circle-small">
                                <p>{{ word.english_word }}</p>
                                {% if word.english_audio %}
                                    <button class="play-audio-btn" onclick="playAudio('{{ word.english_audio.url }}')">ğŸ”Š</button>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Ø³ØªÙˆÙ† ÙØ§Ø±Ø³ÛŒ -->
                        <div class="result-column right-column">
                            <div class="iran-flag-text">
                                <p>{{ word.farsi_word }}</p>
                                <img src="{% static 'iran.png' %}" alt="Iran Flag" class="flag-circle-small iran-flag">
                            </div>
                        </div>
                    </div>

                    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒ -->
                    <div class="additional-info-container">
                        <!-- Ø¬Ø²ÛŒÛŒØ§Øª -->
                        <div class="info-box">
                            <h3>Details</h3>
                            <p>Wortart: <span class="word-type-bold">{{ word.get_word_type_display }}</span></p>
                            {% if word.word_type == 'noun' %}
                                <p>Plural Form: <span class="word-type-bold">{{ word.plural_form }}</span></p>
                                <p>Genitive Form: <span class="word-type-bold">{{ word.genitive_form }}</span></p>
                            {% elif word.word_type == 'verb' %}
                                <p>Simple Past: <span class="word-type-bold">{{ word.simple_past }}</span></p>
                                <p>Perfekt-Partizip: <span class="word-type-bold">{{ word.past_participle }}</span></p>
                                <p>Hilfsverb: <span class="word-type-bold">{{ word.auxiliary_verb }}</span></p>
                            {% elif word.word_type == 'adjective' %}
                                <p>Komparativ: <span class="word-type-bold">{{ word.comparative }}</span></p>
                                <p>Superlativ: <span class="word-type-bold">{{ word.superlative }}</span></p>
                            {% endif %}
                        </div>

                        <!-- ØªØ¹Ø±ÛŒÙ -->
                        <div class="info-box">
                            <h3>Definition</h3>
                            <p>{{ word.definition }}</p>
                        </div>

                        <!-- Ù…ØªØ±Ø§Ø¯Ùâ€ŒÙ‡Ø§ Ùˆ Ù…ØªØ¶Ø§Ø¯Ù‡Ø§ -->
                        <div class="info-box">
                            <h3>Synonyme und Antonyme</h3>
                            <div class="synonyme-box">{{ word.synonyms }}</div>
                            <div class="antonyme-box">{{ word.antonyms }}</div>
                        </div>
                    </div>

                    <!-- Ø¬Ù…Ù„Ø§Øª Ù†Ù…ÙˆÙ†Ù‡ -->
                    <div class="additional-info-container">
                        <div class="info-box">
                            <h3>Beispiel</h3>
                            <div class="sentence-row">
                                <!-- Ø¬Ù…Ù„Ù‡ Ø¢Ù„Ù…Ø§Ù†ÛŒ -->
                                <div class="sentence-column german-sentence">
                                    <div class="german-flag-text">
                                        <img src="{% static 'germany.png' %}" alt="Germany Flag" class="flag-circle-small">
                                        <p>{{ word.german_example_sentence }}</p>
                                        {% if word.audio %}
                                            <button class="play-audio-btn" onclick="playAudio('{{ word.german_example_audio.url }}')">ğŸ”Š</button>
                                        {% endif %}
                                        {% if word.video %}
                                            <button class="play-video-btn" onclick="playVideo('{{ word.video.url }}')">
                                                <img src="{% static 'video.png' %}" alt="Video Icon" class="video-icon">
                                            </button>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Ø¬Ù…Ù„Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ -->
                                <div class="sentence-column english-sentence">
                                    <div class="english-flag-text">
                                        <img src="{% static 'united_kingdom.png' %}" alt="UK Flag" class="flag-circle-small">
                                        <p>{{ word.english_example_sentence }}</p>
                                    </div>
                                    {% if word.audio %}
                                        <button class="play-audio-btn" onclick="playAudio('{{ word.english_example_audio.url }}')">ğŸ”Š</button>
                                    {% endif %}
                                </div>

                                <!-- Ø¬Ù…Ù„Ù‡ ÙØ§Ø±Ø³ÛŒ -->
                                <div class="sentence-column farsi-sentence">
                                    <div class="iran-flag-text">
                                        <p>{{ word.farsi_example_sentence }}</p>
                                        <img src="{% static 'iran.png' %}" alt="Iran Flag" class="flag-circle-small">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ø¯Ú©Ù…Ù‡ Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ ÙÙ„Ø´ Ú©Ø§Ø±Øª -->
                    <div class="add-to-flashcards-btn-container">
                        {% if user.is_authenticated and word.id not in flashcard_ids %}
                            <form method="post" action="{% url 'add_to_flashcards' %}">
                                {% csrf_token %}
                                <input type="hidden" name="word_id" value="{{ word.id }}">
                                <button class="add-to-flashcards-btn" type="submit">Zu Karteikarten hinzufÃ¼gen</button>
                            </form>
                        {% elif user.is_authenticated %}
                            <p class="flashcard-message">Dieses Wort ist bereits in deinen Flashcards.</p>
                        {% endif %}
                    </div>

                {% endfor %}
            {% else %}
                <p>Keine Ergebnisse gefunden. Bitte versuchen Sie es mit einem anderen Suchbegriff.</p>
            {% endif %}
        {% endif %}
    </div>
</main>

<script src="{% static 'vocabulary/js/playAudio.js' %}"></script>
<script src="{% static 'vocabulary/js/playVideo.js' %}"></script>
{% endblock %}
